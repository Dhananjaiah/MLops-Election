groups:
  - name: election_prediction_alerts
    interval: 30s
    rules:
      # API Performance Alerts
      - alert: HighAPILatency
        expr: histogram_quantile(0.95, rate(election_api_request_latency_seconds_bucket[5m])) > 1.0
        for: 5m
        labels:
          severity: warning
          component: api
        annotations:
          summary: "High API latency detected"
          description: "P95 latency is {{ $value }}s (threshold: 1.0s) for {{ $labels.instance }}"

      - alert: CriticalAPILatency
        expr: histogram_quantile(0.95, rate(election_api_request_latency_seconds_bucket[5m])) > 3.0
        for: 2m
        labels:
          severity: critical
          component: api
        annotations:
          summary: "Critical API latency detected"
          description: "P95 latency is {{ $value }}s (threshold: 3.0s) for {{ $labels.instance }}"

      - alert: HighErrorRate
        expr: rate(election_api_requests_total{status="5xx"}[5m]) / rate(election_api_requests_total[5m]) > 0.05
        for: 5m
        labels:
          severity: critical
          component: api
        annotations:
          summary: "High error rate detected"
          description: "Error rate is {{ $value | humanizePercentage }} (threshold: 5%) for {{ $labels.instance }}"

      - alert: LowRequestRate
        expr: rate(election_api_requests_total[5m]) < 0.1
        for: 10m
        labels:
          severity: info
          component: api
        annotations:
          summary: "Low request rate"
          description: "Request rate is {{ $value }} req/s for {{ $labels.instance }}"

      # Model Drift Alerts
      - alert: DataDriftDetected
        expr: election_drift_detected > 0
        for: 1m
        labels:
          severity: high
          component: monitoring
        annotations:
          summary: "Data drift detected"
          description: "Data drift has been detected. Model retraining recommended."

      - alert: HighDriftShare
        expr: election_drift_share > 0.3
        for: 1m
        labels:
          severity: critical
          component: monitoring
        annotations:
          summary: "High drift share detected"
          description: "Drift share is {{ $value | humanizePercentage }} (threshold: 30%)"

      # Model Performance Alerts
      - alert: LowModelAccuracy
        expr: election_model_accuracy < 0.80
        for: 5m
        labels:
          severity: high
          component: model
        annotations:
          summary: "Low model accuracy"
          description: "Model accuracy is {{ $value | humanizePercentage }} (threshold: 80%)"

      - alert: LowPredictionConfidence
        expr: avg(election_prediction_confidence) < 0.6
        for: 10m
        labels:
          severity: warning
          component: model
        annotations:
          summary: "Low prediction confidence"
          description: "Average prediction confidence is {{ $value | humanizePercentage }}"

      # Resource Alerts
      - alert: HighCPUUsage
        expr: rate(container_cpu_usage_seconds_total{pod=~"election-prediction-api.*"}[5m]) > 0.8
        for: 5m
        labels:
          severity: warning
          component: infrastructure
        annotations:
          summary: "High CPU usage"
          description: "CPU usage is {{ $value | humanizePercentage }} for {{ $labels.pod }}"

      - alert: HighMemoryUsage
        expr: container_memory_usage_bytes{pod=~"election-prediction-api.*"} / container_spec_memory_limit_bytes{pod=~"election-prediction-api.*"} > 0.85
        for: 5m
        labels:
          severity: warning
          component: infrastructure
        annotations:
          summary: "High memory usage"
          description: "Memory usage is {{ $value | humanizePercentage }} for {{ $labels.pod }}"

      - alert: PodCrashLooping
        expr: rate(kube_pod_container_status_restarts_total{pod=~"election-prediction-api.*"}[15m]) > 0
        for: 5m
        labels:
          severity: critical
          component: infrastructure
        annotations:
          summary: "Pod is crash looping"
          description: "Pod {{ $labels.pod }} is restarting frequently"

      # Service Availability Alerts
      - alert: ServiceDown
        expr: up{job="election-prediction-api"} == 0
        for: 2m
        labels:
          severity: critical
          component: api
        annotations:
          summary: "Service is down"
          description: "Election prediction API is down for {{ $labels.instance }}"

      - alert: LowServiceAvailability
        expr: avg_over_time(up{job="election-prediction-api"}[5m]) < 0.95
        for: 5m
        labels:
          severity: warning
          component: api
        annotations:
          summary: "Low service availability"
          description: "Service availability is {{ $value | humanizePercentage }} (threshold: 95%)"

      # Data Quality Alerts
      - alert: HighMissingValues
        expr: election_missing_values_total > 100
        for: 5m
        labels:
          severity: warning
          component: data
        annotations:
          summary: "High number of missing values"
          description: "{{ $value }} missing values detected in recent data"

      - alert: LowDataQuality
        expr: election_data_quality_score < 0.85
        for: 10m
        labels:
          severity: warning
          component: data
        annotations:
          summary: "Low data quality score"
          description: "Data quality score is {{ $value | humanizePercentage }} (threshold: 85%)"
